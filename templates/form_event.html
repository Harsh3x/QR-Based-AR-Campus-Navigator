<!DOCTYPE html>
<html lang="en">
<head>
    <title>Protocol: Event Sequence</title>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root { --neon-cyan: #00d2ff; --glass-bg: rgba(10, 16, 30, 0.9); }
        body {
            margin: 0; height: 100vh; display: flex; justify-content: center; align-items: center;
            background: radial-gradient(circle at center, #1a243d 0%, #020408 100%);
            font-family: 'Rajdhani', sans-serif; color: white;
        }
        .hud-card {
            width: 550px; padding: 40px; background: var(--glass-bg);
            border: 1px solid rgba(0, 210, 255, 0.3); border-right: 5px solid var(--neon-cyan);
            backdrop-filter: blur(10px); box-shadow: 0 0 50px rgba(0, 0, 0, 0.5);
        }
        h2 {
            margin: 0 0 25px 0; color: white; font-size: 30px;
            text-transform: uppercase; letter-spacing: 4px; text-shadow: 0 0 10px var(--neon-cyan);
        }
        label { display: block; color: var(--neon-cyan); font-size: 12px; text-transform: uppercase; margin-bottom: 5px; }
        
        input, select, textarea {
            width: 100%; background: #050a14; border: 1px solid #333; color: white;
            padding: 12px; font-size: 16px; font-family: inherit; margin-bottom: 15px; box-sizing: border-box;
            color-scheme: dark;
        }
        
        .time-row { display: flex; gap: 20px; }
        .time-col { flex: 1; }

        button {
            width: 100%; padding: 15px; background: transparent; border: 2px solid var(--neon-cyan);
            color: white; font-size: 18px; font-weight: bold; text-transform: uppercase; letter-spacing: 3px;
            cursor: pointer; transition: 0.3s;
        }
        button:hover { background: var(--neon-cyan); color: black; box-shadow: 0 0 25px var(--neon-cyan); }
    </style>
</head>

<body>
    <div class="hud-card">
        <h2>Schedule Event</h2>
        
        <form id="event-form">
            <label>Event Identifier</label>
            <input type="text" id="event-name" placeholder="DBMS GUEST TALK" required>

            <label>Spatial Location</label>
            <select  id="room-id">
                <option value="1">ISE SEMINAR HALL [001]</option>
                <option value="2">CSE SEMINAR HALL[002]</option>
            </select>

            <div class="time-row">
                <div class="time-col">
                    <label>T-Minus Start</label>
                    <input type="datetime-local" id="startTime" required>
                </div>
                <div class="time-col">
                    <label>T-Minus End</label>
                    <input type="datetime-local" id="endTime" required>
                </div>
            </div>

            <label>Data Payload (Description)</label>
            <textarea rows="3" id = "description" placeholder="INPUT EVENT METADATA..."></textarea>

            <button type="submit">Broadcast to AR Network</button>
        </form>
    </div>

    <script>
        const startInput = document.getElementById('startTime');
        const endInput = document.getElementById('endTime');

        // 1. Set Minimum Date to "Today" (No past events)
        const now = new Date();
        now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
        startInput.min = now.toISOString().slice(0,16);

        // 2. Validate End Time > Start Time on change
        function validateTimes() {
            if(startInput.value && endInput.value) {
                if(endInput.value <= startInput.value) {
                    endInput.setCustomValidity("End time must be after Start time!");
                    endInput.reportValidity(); // Shows the popup bubble immediately
                } else {
                    endInput.setCustomValidity("");
                }
            }
        }

        // Listen for changes
        startInput.addEventListener('change', validateTimes);
        endInput.addEventListener('change', validateTimes);
    </script>

    <script>
    document.getElementById("event-form").addEventListener("submit", async (e) => {
    e.preventDefault();

    const payload = {
        name: document.getElementById("event-name").value.trim(),
        room_id: document.getElementById("room-id").value,
        start_time: document.getElementById("startTime").value,
        end_time: document.getElementById("endTime").value,
        description: document.getElementById("description").value.trim()
    };

    const res = await fetch("/api/events", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
    });

    const data = await res.json();

    if (data.success) {
        alert("Event scheduled successfully");
        document.getElementById("event-form").reset();
    } else {
        alert(data.error || "Failed to create event");
    }
    });
    </script>


</body>
</html>